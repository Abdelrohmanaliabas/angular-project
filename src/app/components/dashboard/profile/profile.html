<p-toast></p-toast>

<div
  class="min-h-screen bg-gray-100 dark:bg-gray-950 flex justify-center items-center py-10 px-4 transition-all duration-300"
>
  <div
    class="max-w-5xl w-full bg-white dark:bg-gray-900 rounded-3xl shadow-xl overflow-hidden grid grid-cols-1 md:grid-cols-3"
  >
    <!-- Left Panel -->
    <div
      class="bg-gradient-to-b from-primary-600 to-blue-500 dark:from-primary-700 dark:to-primary-500 p-8 flex flex-col items-center justify-center text-center text-white"
    >
      <div class="relative group mb-6">
        <img
          [src]="previewUrl || user?.avatar || 'assets/images/img.jpg'"
          alt="Avatar"
          class="w-40 h-40 rounded-full object-cover border-4 border-white shadow-lg group-hover:opacity-70 transition-all"
        />
        <label
          for="avatarUpload"
          class="absolute bottom-0 right-0 bg-white text-gray-800 rounded-full p-2 cursor-pointer shadow-md hover:scale-110 transition-all"
          title="Change Avatar"
        >
          <i class="fa-solid fa-camera"></i>
        </label>
        <input
          type="file"
          id="avatarUpload"
          (change)="onAvatarSelected($event)"
          accept="image/*"
          class="hidden"
        />
      </div>

      <h2 class="text-2xl font-bold">{{ user?.name }}</h2>
      <p class="text-gray-200">{{ user?.role | titlecase }}</p>

      <div class="mt-6 space-y-2 text-sm text-gray-100">
        <p><i class="pi pi-envelope mr-2"></i> {{ user?.email }}</p>
        <p><i class="pi pi-phone mr-2"></i> {{ user?.phone || '—' }}</p>
        <p><i class="pi pi-map-marker mr-2"></i> {{ user?.address || '—' }}</p>
      </div>
    </div>

    <!-- Right Panel -->
    <div class="col-span-2 p-10">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-100">
          Personal Information
        </h2>
        <button
          class="text-primary-600 dark:text-primary-400 hover:underline"
          (click)="toggleEdit()"
        >
          <i class="fa-solid fa-pen-to-square mr-1"></i>
          {{ editing ? 'Cancel' : 'Edit' }}
        </button>
      </div>

      <!-- Edit Form -->
      <form *ngIf="editing; else viewMode" class="space-y-5">
        <div>
          <label class="block text-gray-600 dark:text-gray-300 mb-1">Full Name</label>
          <input
            type="text"
            [(ngModel)]="user.name"
            name="name"
            class="w-full p-3 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-400 outline-none"
          />
        </div>

        <div>
          <label class="block text-gray-600 dark:text-gray-300 mb-1">Email</label>
          <input
            type="email"
            [(ngModel)]="user.email"
            name="email"
            class="w-full p-3 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-400 outline-none"
          />
        </div>

        <div>
          <label class="block text-gray-600 dark:text-gray-300 mb-1">Phone</label>
          <input
            type="tel"
            [(ngModel)]="user.phone"
            name="phone"
            class="w-full p-3 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-400 outline-none"
          />
        </div>

        <div>
          <label class="block text-gray-600 dark:text-gray-300 mb-1">Address</label>
          <input
            type="text"
            [(ngModel)]="user.address"
            name="address"
            class="w-full p-3 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-400 outline-none"
          />
        </div>

        <button
          pButton
          label="{{ loading ? 'Saving...' : 'Save Changes' }}"
          [loading]="loading"
          class="w-full mt-4"
          (click)="saveChanges()"
          type="button"
        ></button>
      </form>

      <!-- View Mode -->
      <ng-template #viewMode>
        <div class="space-y-4 text-gray-700 dark:text-gray-300 text-lg">
          <p><strong>Name:</strong> {{ user?.name }}</p>
          <p><strong>Email:</strong> {{ user?.email }}</p>
          <p><strong>Phone:</strong> {{ user?.phone || '—' }}</p>
          <p><strong>Address:</strong> {{ user?.address || '—' }}</p>
        </div>
      </ng-template>
    </div>
  </div>
</div>
